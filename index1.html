<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Attendance Tracker</title>
<style>
body {font-family: Arial; margin:0; padding:0; background:#e9f3ff;}
.login, .dashboard {width: 60%; margin:50px auto; padding:20px; background:white; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.2);}
input {width:100%; padding:10px; margin:10px 0;}
button {padding:10px 20px; margin-right:5px; cursor:pointer;}
.menu {display:flex; justify-content:center; gap:20px; margin-bottom:15px;}
.menu button {padding:10px 20px; border:none; border-radius:5px; background:#0073e6; color:white;}
.menu button:hover {background:#005bb5;}
.section {display:none;}
table {width:100%; border-collapse:collapse; margin-top:15px;}
table th, table td {border:1px solid #999; padding:8px; text-align:left;}
.bar-container {width:100%; background:#ddd; border-radius:20px; margin-top:10px;}
.bar {height:20px; border-radius:20px; width:0; background:#28a745;}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginDiv" class="login">
    <h2>Admin Login</h2>
    <input type="text" id="adminUser" placeholder="Username" value="admin">
    <input type="password" id="adminPass" placeholder="Password" value="admin123">
    <button onclick="login()">Login</button>
</div>

<!-- DASHBOARD -->
<div id="dashboardDiv" class="dashboard" style="display:none;">
    <div class="menu">
        <button onclick="showSection('addStudent')">Add Student</button>
        <button onclick="showSection('attendance')">Attendance</button>
        <button onclick="showSection('percentage')">Attendance Report</button>
        <button onclick="logout()" style="background:#dc3545;color:white;">Logout</button>
    </div>

    <!-- ADD STUDENT -->
    <div id="addStudent" class="section">
        <h2>Add Student</h2>
        <input id="sname" placeholder="Name">
        <input id="sroll" placeholder="Roll Number">
        <input id="sbatch" placeholder="Batch">
        <button onclick="addStudent()">Add Student</button>

        <h3>Student List</h3>
        <table id="studentTable">
            <tr><th>Name</th><th>Roll</th><th>Batch</th></tr>
        </table>
    </div>

    <!-- ATTENDANCE -->
    <div id="attendance" class="section">
        <h2>Mark Attendance</h2>
        <table id="attTable">
            <tr><th>Roll</th><th>Name</th><th>Mark Present</th><th>Mark Absent</th></tr>
        </table>
    </div>

    <!-- PERCENTAGE REPORT -->
    <div id="percentage" class="section">
        <h2>Attendance Report</h2>
        <table id="reportTable">
            <tr>
                <th>Roll</th>
                <th>Name</th>
                <th>Date</th>
                <th>Day</th>
                <th>Status</th>
                <th>Percentage</th>
            </tr>
        </table>
    </div>
</div>

<script>
// --- Admin Login ---
function login() {
    const u = document.getElementById("adminUser").value;
    const p = document.getElementById("adminPass").value;
    if(u==='admin' && p==='admin123'){
        document.getElementById("loginDiv").style.display='none';
        document.getElementById("dashboardDiv").style.display='block';
        showSection('addStudent');
        loadStudents();
        loadAttendanceTable();
    } else { alert("Invalid credentials"); }
}

function logout(){
    document.getElementById("loginDiv").style.display='block';
    document.getElementById("dashboardDiv").style.display='none';
}

// --- Sections ---
function showSection(id){
    document.querySelectorAll('.section').forEach(s => s.style.display='none');
    document.getElementById(id).style.display='block';
}

// --- Local Storage ---
function getStudents(){ return JSON.parse(localStorage.getItem('students')||'[]'); }
function saveStudents(s){ localStorage.setItem('students',JSON.stringify(s)); }
function getAttendance(){ return JSON.parse(localStorage.getItem('attendance')||'{}'); }
function saveAttendance(a){ localStorage.setItem('attendance',JSON.stringify(a)); }

// --- Add Student ---
function addStudent(){
    const sname=document.getElementById("sname").value.trim();
    const sroll=document.getElementById("sroll").value.trim();
    const sbatch=document.getElementById("sbatch").value.trim();
    if(!sname || !sroll){ alert("Name & Roll required"); return; }
    let students=getStudents();
    if(students.find(s=>s.roll===sroll)){ alert("Roll already exists"); return; }
    students.push({name:sname, roll:sroll, batch:sbatch});
    saveStudents(students);
    document.getElementById("sname").value=""; document.getElementById("sroll").value=""; document.getElementById("sbatch").value="";
    loadStudents();
    loadAttendanceTable();
}

// --- Load Students Table ---
function loadStudents(){
    const students=getStudents();
    const table=document.getElementById("studentTable");
    table.innerHTML='<tr><th>Name</th><th>Roll</th><th>Batch</th></tr>';
    students.forEach(s=>{
        table.innerHTML+=`<tr><td>${s.name}</td><td>${s.roll}</td><td>${s.batch}</td></tr>`;
    });
}

// --- Load Attendance Table ---
function loadAttendanceTable(){
    const students=getStudents();
    const attTable=document.getElementById("attTable");
    attTable.innerHTML='<tr><th>Roll</th><th>Name</th><th>Mark Present</th><th>Mark Absent</th></tr>';
    students.forEach(s=>{
        const tr=document.createElement("tr");
        tr.innerHTML=`<td>${s.roll}</td><td>${s.name}</td>
            <td><button onclick="mark('${s.roll}','P')">P</button></td>
            <td><button onclick="mark('${s.roll}','A')">A</button></td>`;
        attTable.appendChild(tr);
    });
}

// --- Mark Attendance ---
function mark(roll,status){
    let att=getAttendance();
    if(!att[roll]) att[roll]={};
    const dateObj=new Date();
    const date=dateObj.toISOString().split('T')[0];
    const day=dateObj.toLocaleDateString('en-US',{weekday:'long'});
    att[roll][date]={status,statusDay:day};
    saveAttendance(att);
    alert("Marked "+status+" for "+roll);
}

// --- Attendance Report ---
function showReport(){
    const students=getStudents();
    const att=getAttendance();
    const table=document.getElementById("reportTable");
    table.innerHTML='<tr><th>Roll</th><th>Name</th><th>Date</th><th>Day</th><th>Status</th><th>Percentage</th></tr>';

    students.forEach(s=>{
        const records=att[s.roll]||{};
        const dates=Object.keys(records);
        let present=0;
        dates.forEach(d=>{
            const rec=records[d];
            table.innerHTML+=`<tr>
                <td>${s.roll}</td>
                <td>${s.name}</td>
                <td>${d}</td>
                <td>${rec.statusDay}</td>
                <td>${rec.status}</td>
                <td></td>
            </tr>`;
            if(rec.status==='P') present++;
        });
        const percent=dates.length?Math.round(present/dates.length*100):0;
        // Add percentage bar in last row for this student
        if(dates.length>0){
            const lastRow=table.rows[table.rows.length-1];
            lastRow.cells[5].innerHTML=`<div class="bar-container"><div class="bar" style="width:${percent}%"></div></div>${percent}%`;
        }
    });
}

// Update report when user clicks report section
document.querySelector("button[onclick*='showSection']").addEventListener('click',showReport);
</script>
</body>
</html>
